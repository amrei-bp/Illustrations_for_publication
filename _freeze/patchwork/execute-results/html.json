{
  "hash": "e986973632c3dd54ae1ab9b92ef27873",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Combining plots with `patchwork` in `R`\"\nsubtitle: \"adapted from Abu Bakar Siddique, SLUBI, SLU\"\n# date: last-modified\ncode-fold: false\n---\n\n\nIn the previous sessions, you have worked with ggplot2 to create a variety of visualizations in R. Today's session introduces the R package **patchwork**, which provides a simple and intuitive way to combine multiple ggplot objects into a single figure.\n\nDuring the lecture, we will see how patchwork can be used to arrange plots side by side, stack them vertically, and create more complex layouts with minimal additional code.\n\nYou can follow along during the lecture, recreate the examples, and try small modifications to the code.\n\nIn this session, we will work with the palmerpenguins dataset, which contains measurements of penguins from three species collected on islands in the Palmer Archipelago, Antarctica. The dataset includes variables such as bill length, bill depth, flipper length, body mass, and sex, and works nicely for practicing data visualization and analysis.\n\n## Required `Packages`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # data wrangling & plotting\nlibrary(patchwork) # multiple plot alignment\nlibrary(palmerpenguins) # Penguins data\n```\n:::\n\n\n\nCombining two or more `ggplot2` plots is a common task when creating figures. Several R packages can help with this, offering easy ways to arrange plots next to each other, adjust their relative widths and heights, or place one plot inside another as an inset. Below, you’ll find a few alternative options for combining plots.\n\nDuring the session, we will create four ggplot objects: \n\n1. a scatter plot, \n2. a bar plot, \n3. a line plot, and \n4. a boxplot. \n\nUsing these plots, we can test how to combine different plot types with patchwork.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-2\"}\np <- ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g,color=species)) + geom_point()\nq <- ggplot(penguins, aes(x=year, y=body_mass_g, fill=species)) + geom_bar(stat=\"identity\")\nr <- ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g,color=species)) + geom_line()\ns <- ggplot(penguins, aes(x=flipper_length_mm, y=body_mass_g,color=species)) + geom_boxplot()\n```\n:::\n\n\n\n## Combining Plots: horizontally\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + q \n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-2\"}\np | q # pipe\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n::: {.callout-note}\n### Combining plots with patchwork\n\nWhen using **patchwork** to combine `ggplot2` plots, different operators control how the plots are arranged:\n\n- `p + q` adds plots to the layout and lets patchwork decide how to arrange them.\n- `p | q` places plots next to each other in a single row (left to right).\n\nIn simple cases, `p + q` and `p | q` may look the same, but using the pipe, `|`, makes your layout choice explicit and easier to understand.\n:::\n\n## Combining Plots: vertically\n\nTo explicitely stack two plots on top of each other, you can use the slash `/`: \n\n\n::: {.cell}\n\n```{.r .cell-code}\np / q # slash\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n## Building more complex figures\n\nOne of the strengths of **patchwork** is that simple operators can be combined to create more complex layouts. For example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(p | q) / r\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\nHere, `p` and `q` are first placed next to each other using `|`. The result is then combined with `r` using `/`, which stacks `r` **below** the first row. By grouping plots with parentheses, you can control how patchwork interprets the layout.\n\nBy combining operators like `|`, `/`, and `+`, you can gradually build up more complex figures from simple pieces, without needing to learn a separate layout language. This makes it easy to experiment with different arrangements and clearly communicate your results:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(p | q | r) / s\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n**Quiztime:** So how would the following plot look like?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + q + r + s \n```\n:::\n\n\n::: {.callout-tip collapse=\"true\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\n:::\n\n\n## Adding labels to plots\n\nPatchwork also makes it easy to add labels to your combined figures. For example:\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + q + r + s + \n    plot_annotation(tag_levels = 'a')\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\n\nThis adds automatic tags (`a`, `b`, `c`, `d`) to each plot in the order they appear in the layout. These labels are useful when referring to specific panels in a report, presentation, or figure caption.\n\n**You don’t need to label each plot manually** — patchwork takes care of the numbering for you.\n\n::: {.callout-note}\n# Try it yourself!\n\nHow do you think you can change the labels from letters to numbers? To uppercase letters?\n:::\n\n## Figure titles\n\nYou can add figure titles:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-4\"}\np + q + r + s +\n    plot_annotation(tag_levels = 'a',\n        title = \"Combined Plot Example\", \n        subtitle = \"Using patchwork\")\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n## Collecting legends\n\nWhen you combine multiple plots, each plot may come with its own legend. This can make the final figure look repetitive or cluttered. Patchwork allows you to **collect shared legends into a single guide**.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-5\"}\np + q + r + s +\n    plot_annotation(tag_levels = 'a',\n        title = \"Combined Plot Example\", \n        subtitle = \"Using patchwork\")+ \n    plot_layout(guides = 'collect') \n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-12-1.png){width=768}\n:::\n:::\n\n\nThe `guides = \"collect\"` option gathers matching legends from all plots and displays them only once in the combined figure. This helps keep your figure clean and easier to read.\n\n::: {.callout-note}\nWhat to watch out for:\n\n- Legends are only collected if the aesthetics match (for example, the same variable mapped to color or fill).\n- If plots use different scales or different variables for the same aesthetic, patchwork will keep separate legends.\n- Small differences in how aesthetics are defined can prevent legends from being collected, even if the plots look similar.\n\nIf the legends are not collected as expected, check that the same variables and scales are used across plots.\n:::\n\n## Combine titles and collected legends\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-6\"}\np + q + r + s +\n    plot_annotation(tag_levels = 'a',\n        title = \"Combined Plot Example\", \n        subtitle = \"Using patchwork\") + \n    plot_layout(guides = 'collect', \n        ncol = 2)\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-13-1.png){width=768}\n:::\n:::\n\n\n\n## Change theme\n\nYou can change the theme of the combined plot, just like you would for an individual plot.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-8,\"}\np + q + r + s + \n    plot_annotation(tag_levels = 'a',\n        title = \"Combined Plot Example\", \n        subtitle = \"Using patchwork\") + \n    plot_layout(guides = 'collect', \n        ncol = 2) & \n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-14-1.png){width=768}\n:::\n:::\n\n\n::: {.callout-note}\n# + vs & in ggplot2 and patchwork\n\nWhen you combine plots using patchwork, the operators + and & look similar but do different things when adding themes.\n\n`+` applies to a single plot (or the last plot)\n\nThe `+` operator in patchwork behaves the same way as in normal ggplot2:\n\n- It adds layers, scales, or themes to one plot\n- When used in a patchwork expression, **it usually affects only the plot it is directly attached to**.\n\n> p1 + theme_minimal()\n\nHere, `theme_minimal()` is applied only to `p1`.\n\nIn a patchwork layout:\n\n> (p1 | p2) + theme_minimal()\n\nThe theme is applied only to the combined patchwork object, but **not propagated to all individual plots in a consistent way**. This often leads to confusion or unexpected results.\n\n`&` applies to all plots in patchwork to make global styling explicit\n\n- The `&` operator is specific to patchwork.\n- It applies a theme (or other ggplot settings) to every plot in the patchwork.\n- It is designed specifically for global styling.\n\n> (p1 | p2) & theme_minimal()\n\nHere, `theme_minimal()` is **applied to both p1 and p2**.\n\nThis is the preferred way to apply a common theme when working with multiple plots.\n:::\n\n## Abu's script for `Journal: BMC`\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + q + r + s + \n    plot_annotation(tag_levels = list(c('a','c','b','d'))) + \n    plot_layout(widths = c(2, 2)) &\n    theme(legend.position = \"right\", \n        legend.title = element_text(size = 10),\n        legend.text = element_text(size = 8), \n        legend.key.size = unit(0.2, 'cm'), \n        plot.tag = element_text(size = 14,face = 'bold')) \n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n## Adding inset plots\n\nPatchwork also allows you to place one plot *inside* another plot as an inset. This can be useful when you want to highlight a subset of the data or show a related view without creating a separate panel.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np + inset_element(q, 0.01, 0.59, 0.5, 0.9)\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-16-1.png){width=768}\n:::\n:::\n\n\nIn this example, `q` is added as an inset inside plot `p`. The four numbers define the position of the inset, as **proportions of the main plot area**:\n\n- the first two values control the horizontal placement (left and right),\n- the last two values control the vertical placement (bottom and top).\n\nBy adjusting these values, you can move and resize the inset plot to fit your figure.\n\n## Does patchwork work with base R plots?\n\nNo. **Patchwork only works with `ggplot2` plots.**  \nThis is because patchwork combines plots by working with `ggplot` objects behind the scenes.\n\nBase R plots (created with functions like `plot()`, `hist()`, or `boxplot()`) are drawn directly to the graphics device and are not stored as objects in the same way. Because of this, patchwork cannot rearrange or combine them.\n\n\n### Workaround:\n\nWe said that patchwork only works with `ggplot2` plots. That is *mostly* true — but there is a useful exception.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nold_par <- par(mar = c(0, 0, 0, 0), mgp = c(1, 0.25, 0),\n    bg = NA, cex.axis = 0.75, las = 1, tcl = -0.25)\n\nplot_object <- p + ~plot(penguins$flipper_length_mm, penguins$body_mass_g, main = 'Base plot')\nplot_object\n```\n\n::: {.cell-output-display}\n![](patchwork_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nIn this example, the base R plot is wrapped inside `~` (a formula). This tells patchwork to **capture the output of the base plot and treat it as a graphical object**, rather than a regular base plot.\n\nSo patchwork is not combining base plots directly. Instead, it is embedding the base plot as an element inside a patchwork layout.\n\n::: {.callout-note}\n- The base plot is not a `ggplot` object and cannot be modified with `ggplot2` layers.\n- You cannot easily collect legends or align axes between base plots and ggplots.\n- This approach is useful for quick comparisons or demonstrations, but mixing plot systems can be limiting.\n:::\n\n\n## Saving plots\n\nCombined plots created with **patchwork** can be saved in the same way as regular `ggplot2` plots. Since a patchwork object behaves like a ggplot object, you can use `ggsave()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"plot.tiff\",plot_object,height=170,width=85,units=\"mm\",dpi=300,type=\"cairo\", device=tiff)\n# https://bmcmicrobiol.biomedcentral.com/submission-guidelines/preparing-your-manuscript#preparing+figures\n```\n:::\n\n\nThis is the recommended approach for saving ggplot- and patchwork-based figures, especially for publication-quality output.\n\nIt is also possible to save ggplot objects using base R graphics devices:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npng(\"plot.tiff\",height=170,width=85,units=\"mm\",res=300)\nprint(p)\ndev.off()\n```\n:::\n\n\nHere, print(p) is required to draw the ggplot object to the graphics device.\n\n::: {.callout-note}\n- `ggsave()` automatically uses the size and resolution you specify and is usually the easiest option.\n- When using base graphics devices (`png()`, `tiff()`), you must call `print()` for ggplot or patchwork objects.\n- Patchwork figures are saved as a single plot, just like any other ggplot object.\n- Always check journal or report guidelines for required file formats, sizes, and resolution.\n:::\n\n## Documentation and help:\n\n-   [**patchwork**](https://patchwork.data-imaginist.com/) documentation\n-   [Getting Started](https://patchwork.data-imaginist.com/articles/patchwork.html)\n-   [Assembling Plots](https://patchwork.data-imaginist.com/articles/guides/assembly.html)\n-   [Defining Layouts](https://patchwork.data-imaginist.com/articles/guides/layout.html)\n-   [Adding Annotation](https://patchwork.data-imaginist.com/articles/guides/annotation.html)\n-   [Aligning across pages](https://patchwork.data-imaginist.com/articles/guides/multipage.html)\n-   [**chatgpt**]()",
    "supporting": [
      "patchwork_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}